---
# Test: Verify that Ansible automatically loads group_vars/all/ files
# This test runs against localhost (like our provisioners) to verify
# that variables from group_vars/all/ are available without explicit vars_files

- name: Test automatic group_vars loading for localhost plays
  hosts: localhost
  connection: local
  gather_facts: False
  
  # NO vars_files section - testing automatic loading only

  tasks:
    - name: Verify that vars.yml variables are loaded automatically
      ansible.builtin.assert:
        that:
          - my_ansible_user is defined
          - my_ssh_key_name is defined
        fail_msg: "Variables from group_vars/all/vars.yml are not automatically loaded"
        success_msg: "âœ… Variables from group_vars/all/vars.yml loaded successfully"

    - name: Verify that vault.yml variables are loaded automatically  
      ansible.builtin.assert:
        that:
          - vault_my_ssh_key_name is defined
          - vault_my_ansible_user_password is defined
        fail_msg: "Variables from group_vars/all/vault.yml are not automatically loaded"
        success_msg: "âœ… Variables from group_vars/all/vault.yml loaded successfully"

    - name: Verify that vault variables are properly referenced
      ansible.builtin.assert:
        that:
          - my_ansible_user_password is defined
          - my_ansible_user_password != ""
        fail_msg: "Vault variable references in vars.yml are not working"
        success_msg: "âœ… Vault variable references working correctly"

    - name: Display test results
      ansible.builtin.debug:
        msg: |
          ðŸŽ¯ Test Results:
          - my_ansible_user: {{ my_ansible_user }}
          - SSH key name: {{ my_ssh_key_name }}
          - Password reference works: {{ 'Yes' if my_ansible_user_password else 'No' }}
          
          âœ… All group_vars/all/ files are automatically loaded for localhost plays!